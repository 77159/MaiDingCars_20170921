!function(t){function i(t){t=t||{},this.map=t.map,this.heatMap=fengmap.FMHeatMap.create(map,{radius:t.radius||20,opacity:t.opacity||.5,max:t.max||100}),this.loop=void 0===t.loop||t.loop,this.textures=[],this.materials=[],this.fadeTime=.5,this.stayTime=.5,this._pause=!0,this._fadeCnt=0,this._stayCnt=0,this._sign=0,this._index=0,this._start=!1,this._jumpIndex=-1,this.isPlaying=!1,this.updateFunc=this._update.bind(this)}i.prototype={constructor:i,createTextures:function(t){var i=this,e=[];if(!(t.length<2))return t.forEach(function(t){e.push(i.heatMap.getTexture(t))}),e;console.log("点集数量小于 2 , 不能制作动画")},setTextures:function(t){this.textures=t},play:function(t,i){!this.isPlaying&&this.textures.length&&(void 0!==t&&(this.fadeTime=t),void 0!==i&&(this.stayTime=i),this.isPlaying=!0,this._pause=!1,this.collectMaterials(this.map.focusGroupID),this.map.on("update",this.updateFunc))},pause:function(){this._pause=!0},resume:function(){this._pause=!1},stop:function(){this.isPlaying=!1,this.map.off("update",this.updateFunc),this._index=0,this._fadeCnt=this._stayCnt=0,this._sign=0,this._start=!1,this._pause=!0,this._pause=!0,this.materials.forEach(function(t){t.map=null,t.needsUpdate=!0})},jumpTo:function(t){t=Math.min(Math.max(t,0),this.textures.length),this._jumpIndex=t},collectMaterials:function(t){t=t||this.map.focusGroupID,this.materials=this.heatMap.collectMaterials(t)},_clearMaterialMap:function(){this.materials.forEach(function(t){t.map=null})},clearTextures:function(){this.stop(),this._clearMaterialMap(),this.textures.forEach(function(t){t.dispose()}),this.textures.length=0},_changeSwap:function(t){this.materials.length&&this.materials.forEach(function(i){i.swap=t,i.needsUpdate=!0})},_update:function(t){var i=this;if(!i._pause)if(i._sign=i._index%2,i._start||(i._start=!0,i.materials.forEach(function(t){t.map=i.textures[0],t.map2=i.textures[1],t.needsUpdate=!0})),i._fadeCnt>=1){if(!i._stayCnt){if(i._jumpIndex>-1?(i._index=i._jumpIndex,i._jumpIndex=-1):i._index++,i._index===i.textures.length){if(!this.loop)return void i.stop();i._index=0}i.materials.forEach(function(t){i._sign?t.map=i.textures[i._index]:t.map2=i.textures[i._index]})}i._stayCnt+=t/i.stayTime,i._stayCnt>=1&&(i._stayCnt=0,i._fadeCnt=0)}else{i._fadeCnt+=t/i.fadeTime;var e=Math.min(Math.max(i._sign?i._fadeCnt:1-i._fadeCnt,0),1);i._changeSwap(e)}}},t.HeatMapAnimation=i}(this.fengmap=this.fengmap||{});